/* =====================
     DIFF INLINE DECORATIONS
     ===================== */

/* --- Diff color variables --- */
:root {
  --diff-added-bg: rgba(35, 134, 54, 0.08);
  --diff-added-border: rgba(35, 134, 54, 0.3);

  --diff-removed-bg: rgba(208, 44, 55, 0.07);
  --diff-removed-border: rgba(208, 44, 55, 0.28);
  --diff-removed-text: var(--tt-gray-light-a-500);
}

.dark {
  --diff-added-bg: rgba(46, 160, 67, 0.12);
  --diff-added-border: rgba(46, 160, 67, 0.3);

  --diff-removed-bg: rgba(248, 81, 73, 0.1);
  --diff-removed-border: rgba(248, 81, 73, 0.28);
  --diff-removed-text: var(--tt-gray-dark-a-500);
}

/* ── Node decorations: green background for added / modified blocks ── */
/* Only horizontal expansion — NO vertical padding so text doesn't shift */

.tiptap.ProseMirror {
  .diff-node-added,
  .diff-node-modified {
    background-color: var(--diff-added-bg);
    border-left: 3px solid var(--diff-added-border);
    border-radius: var(--tt-radius-sm, 6px);
    padding-left: 12px;
    padding-right: 14px;
    margin-left: -15px;
    margin-right: -14px;
    /* Minimal vertical padding with matching negative margin to keep position */
    padding-top: 4px;
    padding-bottom: 4px;
    margin-top: -4px;
    margin-bottom: -4px;
    transition: background-color 0.15s ease;
  }
}

/* ── Widget decorations: old / removed blocks (red background) ── */
/* Rich-rendered HTML from the editor's own markdown parser + schema */

.diff-old-block {
  position: relative;
  background-color: var(--diff-removed-bg);
  border-left: 3px solid var(--diff-removed-border);
  border-radius: var(--tt-radius-sm, 6px);
  padding: 4px 14px 4px 12px;
  margin-left: -15px;
  margin-right: -14px;
  margin-bottom: 6px;
  user-select: none;
  pointer-events: none;
  transition: background-color 0.15s ease;
}

/* The rich-rendered content inside the old block */
.diff-old-block-content {
  opacity: 0.75;

  /* All text gets the removed styling */
  &,
  & * {
    color: var(--diff-removed-text) !important;
    text-decoration: line-through;
    text-decoration-color: var(--diff-removed-border);
  }

  /* Reset margins on rendered child elements so they don't add extra space */
  > p,
  > h1,
  > h2,
  > h3,
  > h4,
  > h5,
  > h6,
  > ul,
  > ol,
  > blockquote,
  > pre {
    margin-top: 0;
    margin-bottom: 0;
  }

  /* Links shouldn't look clickable */
  a {
    pointer-events: none;
    text-decoration: line-through !important;
  }

  /* Inline code in old blocks */
  code {
    background: transparent !important;
  }
}

/* ── Character-level highlights within modified blocks ── */

/* Changed characters in the green (new) block */
.diff-char-added {
  background-color: rgba(35, 134, 54, 0.2);
  border-radius: 2px;

  .dark & {
    background-color: rgba(46, 160, 67, 0.25);
  }
}

/* Changed characters in the red (old) widget */
.diff-char-removed {
  background-color: rgba(208, 44, 55, 0.18);
  border-radius: 2px;

  .dark & {
    background-color: rgba(248, 81, 73, 0.22);
  }
}
